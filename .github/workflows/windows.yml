name: Windows

on:
  push:
  pull_request:

jobs:

  msvc:
    runs-on: windows-latest
    env:
      VULKAN_SDK: ${{ github.workspace }}\VulkanSDK

    steps:
      - name: Cache Vulkan SDK
        id: cache-vulkan-sdk
        uses: actions/cache@v1
        with:
          path: "C:\\VulkanSDK\\1.2.135.0"
          key: vulkan-sdk-1.2.135.0

      - name: Setup Vulkan
        if: steps.cache-vulkan-sdk.outputs.cache-hit != 'true'
        run: |
          Invoke-WebRequest -Uri "https://sdk.lunarg.com/sdk/download/1.2.135.0/windows/VulkanSDK-1.2.135.0-Installer.exe" -OutFile VulkanSDK.exe
          $installer = Start-Process -FilePath VulkanSDK.exe -Wait -PassThru -ArgumentList @("/S");
          $installer.WaitForExit();

      #- name: Vulkan
      #  uses: actions/checkout@v3
      #  with:
      #    repository: 'krOoze/vk_sdk_lite'
      #    path: ${{ env.VULKAN_SDK }}
      #    ref: windows
        # uses: humbletim/setup-vulkan-sdk@v1.2.0
        # with:
        #   vulkan-query-version: 1.3.204.0
        #   vulkan-components: Vulkan-Headers, Vulkan-Loader
        #   vulkan-use-cache: true

      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: 'recursive'

      - name: Run CMake
        run: cmake -S ./Sogas -B ./build -G "Visual Studio 17 2022"
      - name: Build
        run: cmake --build build --parallel 10
